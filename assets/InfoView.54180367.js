import{d as R,i as L,A as K,b as P,O as H,r as A,e as Q,o as W,W as J,Y as X,f as p,K as G,L as I,k as e,p as a,l as r,w as u,j as d,g as y,v as E,x as T,F as U,m as g,h as x,s as B,a as Z,P as ee,Q as te,R as ae,S as le,T as ue,U as oe,V as ne}from"./index.f9e09ed2.js";import{d as se,f as j,o as O}from"./mixin.fa525c43.js";const de={key:0},re={key:0},ie={key:0},pe={key:0},me={key:0},ce={key:0},fe={key:0},_e={class:"text-right"},ye=R({__name:"InfoForm",props:{type:{type:String,default:"view"},id:{type:Number,default:0},path:{type:String,default:""}},emits:["toggleModal"],setup(S,{emit:b}){const m=S,t=L(K),_=P();H(()=>{se()});const c=A(),l=A({id:0,company:{id:null},username:"",name:"",dept:{id:null},applyDate:null,leaveDate:null,password:"",activation:!1}),h=Q(()=>({username:[{required:!0,message:"\u8ACB\u8F38\u5165\u4EE3\u865F",trigger:"blur"},{max:50,message:"\u6700\u5927\u9577\u5EA6\u70BA50",trigger:"blur"},{validator:O,trigger:"blur"}],name:[{required:!0,message:"\u8ACB\u8F38\u5165\u540D\u7A31",trigger:"blur"},{max:30,message:"\u6700\u5927\u9577\u5EA6\u70BA30",trigger:"blur"}],applyDate:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}],company:{id:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}]},dept:{id:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}]},password:[{required:!0,min:8,max:20,message:"\u8ACB\u8F38\u5165\uFF0C\u9577\u5EA6\u4ECB\u65BC8~20",trigger:"blur"},{validator:O,trigger:"blur"}]})),s=A([]),F=A(0);return W(async()=>{if(m.id>0){const C=await _.dispatch("getModalData",{http:t,path:m.path,id:m.id});C&&(l.value=C.data)}_.state.company.length&&m.type!=="edit"&&(l.value.company.id=_.state.company[0].id),m.type!=="view"&&J(()=>l.value.company.id,C=>{F.value++;const n={companyId:C};t.get("/dept/info/option",{params:n}).then(v=>{s.value=v.data,(F.value!==1||m.type!=="edit")&&(l.value.dept.id=null)}).catch(v=>{X.error(v.toString())})},{immediate:!0})}),(C,n)=>{const v=p("el-input"),f=p("el-form-item"),Y=p("el-option"),V=p("el-select"),k=p("el-date-picker"),D=p("el-switch"),M=p("el-button"),z=p("el-form"),$=G("loading");return I((a(),r(z,{ref_key:"formRef",ref:c,model:l.value,rules:h.value,"label-width":"100px"},{default:u(()=>[d(f,{label:"\u4EBA\u54E1\u4EE3\u865F",prop:"username"},{default:u(()=>[m.type==="view"?(a(),y("label",de,E(l.value.username),1)):(a(),r(v,{key:1,modelValue:l.value.username,"onUpdate:modelValue":n[0]||(n[0]=i=>l.value.username=i),maxlength:"50",clearable:""},null,8,["modelValue"]))]),_:1}),d(f,{label:"\u4EBA\u54E1\u540D\u7A31",prop:"name"},{default:u(()=>[m.type==="view"?(a(),y("label",re,E(l.value.name),1)):(a(),r(v,{key:1,modelValue:l.value.name,"onUpdate:modelValue":n[1]||(n[1]=i=>l.value.name=i),clearable:""},null,8,["modelValue"]))]),_:1}),e(_).state.user.superUser?(a(),r(f,{key:0,label:"\u6240\u5C6C\u516C\u53F8",prop:"company.id"},{default:u(()=>[m.type==="view"?(a(),y("label",ie,E(l.value.company.name),1)):(a(),r(V,{key:1,modelValue:l.value.company.id,"onUpdate:modelValue":n[2]||(n[2]=i=>l.value.company.id=i),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(a(!0),y(U,null,T(e(_).state.company,i=>(a(),r(Y,{key:i.id,label:i.name,value:i.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]),_:1})):g("",!0),d(f,{label:"\u90E8\u9580",prop:"dept.id"},{default:u(()=>{var i;return[m.type==="view"?(a(),y("label",pe,E((i=l.value.dept)==null?void 0:i.name),1)):(a(),r(V,{key:1,modelValue:l.value.dept.id,"onUpdate:modelValue":n[3]||(n[3]=w=>l.value.dept.id=w),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(a(!0),y(U,null,T(s.value,w=>(a(),r(Y,{key:w.id,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1}),d(f,{label:"\u5831\u8058\u65E5",prop:"applyDate"},{default:u(()=>[m.type==="view"?(a(),y("label",me,E(e(j)(l.value.applyDate)),1)):(a(),r(k,{key:1,modelValue:l.value.applyDate,"onUpdate:modelValue":n[4]||(n[4]=i=>l.value.applyDate=i),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u8ACB\u9078\u64C7"},null,8,["modelValue"]))]),_:1}),d(f,{label:"\u96E2\u8077\u65E5",prop:"leaveDate"},{default:u(()=>[m.type==="view"?(a(),y("label",ce,E(e(j)(l.value.leaveDate)),1)):(a(),r(k,{key:1,modelValue:l.value.leaveDate,"onUpdate:modelValue":n[5]||(n[5]=i=>l.value.leaveDate=i),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u8ACB\u9078\u64C7"},null,8,["modelValue"]))]),_:1}),m.type==="add"?(a(),r(f,{key:1,label:"\u5BC6\u78BC",prop:"password"},{default:u(()=>[d(v,{modelValue:l.value.password,"onUpdate:modelValue":n[6]||(n[6]=i=>l.value.password=i),type:"password",maxlength:"20",placeholder:"\u5BC6\u78BC",clearable:""},null,8,["modelValue"])]),_:1})):g("",!0),d(f,{label:"\u555F\u7528",prop:"activation"},{default:u(()=>[m.type==="view"?(a(),y("label",fe,E(l.value.activation?"\u662F":"\u5426"),1)):(a(),r(D,{key:1,modelValue:l.value.activation,"onUpdate:modelValue":n[7]||(n[7]=i=>l.value.activation=i),"active-text":"\u662F","inactive-text":"\u5426"},null,8,["modelValue"]))]),_:1}),x("div",_e,[d(M,{onClick:n[8]||(n[8]=i=>b("toggleModal",!1))},{default:u(()=>[B("\u95DC\u9589")]),_:1}),m.type!=="view"?(a(),r(M,{key:0,type:"primary",onClick:n[9]||(n[9]=i=>e(_).dispatch("saveData",{http:e(t),path:S.path,form:l.value,ref:c.value}))},{default:u(()=>[B("\u5132\u5B58")]),_:1})):g("",!0)])]),_:1},8,["model","rules"])),[[$,e(_).state.progressing]])}}}),ge=x("div",{class:"card-header"},"\u67E5\u8A62\u689D\u4EF6",-1),ve={class:"grid sm:gap-x-8 sm:grid-cols-2"},be={class:"card-header flex justify-between items-center"},he=x("span",null,"\u67E5\u8A62\u7D50\u679C",-1),we=R({__name:"InfoView",setup(S){const b=L(K),m=Z(),t=P(),_=A(m.path),c=ee({username:"",name:"",company:{id:null}});W(async()=>{await t.dispatch("getCompany",{http:b}),t.state.company.length&&(c.company.id=Number(t.state.user.companyId))});const l=Q(()=>{const h={page:t.state.page,pageSize:t.state.pageSize};return c.username.length>0&&(h.username=c.username),c.name.length>0&&(h.name=c.name),c.company.id>0&&(h.companyId=c.company.id),h});return(h,s)=>{const F=p("el-option"),C=p("el-select"),n=p("el-form-item"),v=p("el-input"),f=p("el-button"),Y=p("el-form"),V=p("el-card"),k=p("el-table-column"),D=p("el-tooltip"),M=p("el-button-group"),z=p("el-table"),$=p("el-pagination"),i=p("el-space"),w=p("el-dialog"),q=G("loading");return a(),y(U,null,[d(i,{size:20,fill:!0,class:"w-full px-4"},{default:u(()=>[I((a(),r(V,{class:"box-card"},{header:u(()=>[ge]),default:u(()=>[d(Y,{"label-position":"left"},{default:u(()=>[x("div",ve,[e(t).state.user.superUser?(a(),r(n,{key:0,label:"\u6240\u5C6C\u516C\u53F8",prop:"company.id"},{default:u(()=>[d(C,{modelValue:c.company.id,"onUpdate:modelValue":s[0]||(s[0]=o=>c.company.id=o),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(a(!0),y(U,null,T(e(t).state.company,o=>(a(),r(F,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):g("",!0),d(n,{label:"\u4EBA\u54E1\u4EE3\u865F",prop:"username"},{default:u(()=>[d(v,{modelValue:c.username,"onUpdate:modelValue":s[1]||(s[1]=o=>c.username=o),placeholder:"\u8F38\u5165\u4EBA\u54E1\u4EE3\u865F",maxlength:"50",clearable:""},null,8,["modelValue"])]),_:1}),d(n,{label:"\u4EBA\u54E1\u540D\u7A31",prop:"name"},{default:u(()=>[d(v,{modelValue:c.name,"onUpdate:modelValue":s[2]||(s[2]=o=>c.name=o),placeholder:"\u8F38\u5165\u4EBA\u54E1\u540D\u7A31",clearable:""},null,8,["modelValue"])]),_:1})]),e(t).state.show.read?(a(),r(f,{key:0,icon:e(te),type:"primary",onClick:s[3]||(s[3]=o=>e(t).dispatch("getData",{http:e(b),path:_.value,data:l.value})),class:"!flex w-full sm:w-56 mx-auto"},{default:u(()=>[B("\u9EDE\u6211\u67E5\u8A62")]),_:1},8,["icon"])):g("",!0)]),_:1})]),_:1})),[[q,e(t).state.progressing]]),I((a(),r(V,{class:"box-card"},{header:u(()=>[x("div",be,[he,e(t).state.show.create?(a(),r(f,{key:0,onClick:s[4]||(s[4]=o=>e(t).dispatch("action",{type:"add",id:0})),icon:e(ae),type:"primary",plain:""},{default:u(()=>[B("\u65B0\u589E\u4EBA\u54E1")]),_:1},8,["icon"])):g("",!0)])]),default:u(()=>[d(z,{data:e(t).state.table,flexible:!0,border:""},{default:u(()=>[d(k,{prop:"username",label:"\u4EBA\u54E1\u4EE3\u865F"}),d(k,{prop:"name",label:"\u4EBA\u54E1\u540D\u7A31"}),d(k,{prop:"dept.name",label:"\u90E8\u9580"}),d(k,{label:"\u64CD\u4F5C",fixed:"right",width:"150",align:"center"},{default:u(o=>[d(M,null,{default:u(()=>[e(t).state.show.detail?g("",!0):(a(),r(f,{key:0,icon:e(le),round:"",disabled:""},{default:u(()=>[B("\u7121\u6B0A\u9650")]),_:1},8,["icon"])),e(t).state.show.detail?(a(),r(D,{key:1,class:"box-item",effect:"dark",content:"\u700F\u89BD",placement:"top","hide-after":0},{default:u(()=>[d(f,{onClick:N=>e(t).dispatch("action",{type:"view",id:o.row.id}),icon:e(ue)},null,8,["onClick","icon"])]),_:2},1024)):g("",!0),e(t).state.show.update?(a(),r(D,{key:2,class:"box-item",effect:"dark",content:"\u7DE8\u8F2F",placement:"top","hide-after":0},{default:u(()=>[d(f,{onClick:N=>e(t).dispatch("action",{type:"edit",id:o.row.id}),icon:e(oe)},null,8,["onClick","icon"])]),_:2},1024)):g("",!0),e(t).state.show.delete?(a(),r(D,{key:3,class:"box-item",effect:"dark",content:"\u522A\u9664",placement:"top","hide-after":0},{default:u(()=>[d(f,{onClick:N=>e(t).dispatch("handleDelete",{http:e(b),path:_.value,data:l.value,row:o.row}),icon:e(ne),type:"danger",plain:""},null,8,["onClick","icon"])]),_:2},1024)):g("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),e(t).state.table.length>0?(a(),r($,{key:0,onSizeChange:s[5]||(s[5]=o=>e(t).dispatch("handleSizeChange",{http:e(b),path:_.value,data:l.value,val:o})),onCurrentChange:s[6]||(s[6]=o=>e(t).dispatch("handleCurrentChange",{http:e(b),path:_.value,data:l.value,val:o})),"current-page":e(t).state.page,"onUpdate:currentPage":s[7]||(s[7]=o=>e(t).state.page=o),"page-size":e(t).state.pageSize,"onUpdate:pageSize":s[8]||(s[8]=o=>e(t).state.pageSize=o),"page-sizes":[10,25,50,100],total:e(t).state.total,layout:"total, sizes, prev, pager, next",class:"flex flex-wrap justify-center mt-4"},null,8,["current-page","page-size","total"])):g("",!0)]),_:1})),[[q,e(t).state.progressing]])]),_:1}),d(w,{modelValue:e(t).state.modalOpen,"onUpdate:modelValue":s[10]||(s[10]=o=>e(t).state.modalOpen=o),title:e(t).getters.actionTitle,"append-to-body":!0,"close-on-click-modal":!1,width:"95%",style:{"max-width":"600px"}},{default:u(()=>[(a(),r(ye,{key:e(t).state.actionType+e(t).state.actionId,onToggleModal:s[9]||(s[9]=o=>e(t).commit("updateModalOpen",o)),type:e(t).state.actionType,id:e(t).state.actionId,path:_.value},null,8,["type","id","path"]))]),_:1},8,["modelValue","title"])],64)}}});export{we as default};
