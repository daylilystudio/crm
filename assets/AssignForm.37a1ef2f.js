import{d as I,i as K,A as L,b as T,r as C,o as Z,f as d,K as q,L as z,k as c,p as r,l as B,w as l,g as b,j as e,C as G,s as i,h as s,v as o,F as v,m as y,E as N,Z as S,x as H}from"./index.b0b44b5a.js";import{_ as J}from"./plugin-vueexport-helper.2444895f.js";const O={class:"text-right"},P=I({__name:"AssignForm",props:{type:{type:String,default:"view"},id:{type:Number,default:0},path:{type:String,default:""}},emits:["toggleModal"],setup(D,{emit:U}){const u=D,h=K(L),n=T(),E=C(),t=C({id:0,company:{id:0,code:"",name:""},personnel:{id:0,username:"",name:""},pattens:[]}),A=C([]);Z(async()=>{if(u.id>0){if(n.state.show.update){const _=await n.dispatch("getModalData",{http:h,path:u.path,id:u.id});_&&(t.value=_.data),t.value.id=u.id}if(u.type==="assign"&&n.state.show.roleUpdate){const _=await n.dispatch("getModalData",{http:h,path:`${u.path}/role`,id:u.id});_&&(A.value=_.data),A.value.id=u.id}}});const M=async()=>{n.state.show.update&&await n.dispatch("saveData",{http:h,path:u.path,form:t.value,ref:E.value}),u.type==="assign"&&n.state.show.roleUpdate&&await n.dispatch("saveData",{http:h,path:`${u.path}/role`,form:A.value,ref:E.value})};return(_,k)=>{const g=d("el-icon"),w=d("el-divider"),m=d("el-form-item"),f=d("el-table-column"),x=d("el-checkbox"),R=d("el-checkbox-group"),F=d("el-table"),V=d("el-button"),$=d("el-form"),j=q("loading");return z((r(),B($,{class:"!-mt-4",ref_key:"formRef",ref:E,model:t.value,"label-width":"90px"},{default:l(()=>[t.value.company?(r(),b(v,{key:0},[e(w,null,{default:l(()=>[e(g,null,{default:l(()=>[e(c(G))]),_:1}),i(" \u516C\u53F8\u8CC7\u8A0A")]),_:1}),e(m,{label:"Company ID",prop:"company.code"},{default:l(()=>[s("label",null,o(t.value.company.code),1)]),_:1}),e(m,{label:"Company Name",prop:"company.name"},{default:l(()=>[s("label",null,o(t.value.company.name),1)]),_:1})],64)):y("",!0),t.value.personnel?(r(),b(v,{key:1},[e(w,null,{default:l(()=>[e(g,null,{default:l(()=>[e(c(N))]),_:1}),i(" \u4EBA\u54E1\u8CC7\u8A0A")]),_:1}),e(m,{label:"\u4EBA\u54E1\u4EE3\u865F",prop:"personnel.code"},{default:l(()=>[s("label",null,o(t.value.personnel.code),1)]),_:1}),e(m,{label:"\u4EBA\u54E1Name",prop:"personnel.name"},{default:l(()=>[s("label",null,o(t.value.personnel.name),1)]),_:1})],64)):y("",!0),t.value.role?(r(),b(v,{key:2},[e(w,null,{default:l(()=>[e(g,null,{default:l(()=>[e(c(N))]),_:1}),i(" \u89D2\u8272\u8CC7\u8A0A")]),_:1}),e(m,{label:"\u89D2\u8272\u4EE3\u865F",prop:"role.code"},{default:l(()=>[s("label",null,o(t.value.role.code),1)]),_:1}),e(m,{label:"\u89D2\u8272Name",prop:"role.name"},{default:l(()=>[s("label",null,o(t.value.role.name),1)]),_:1})],64)):y("",!0),c(n).state.show.update?(r(),b(v,{key:3},[e(w,null,{default:l(()=>[e(g,null,{default:l(()=>[e(c(S))]),_:1}),i(" "+o(D.type==="assign"?"\u4EBA\u54E1":"\u89D2\u8272")+"\u6B0A\u9650\u8A2D\u5B9A",1)]),_:1}),e(F,{border:"",stripe:"",data:t.value.pattens,class:"mb-14"},{default:l(()=>[e(f,{label:"\u529F\u80FD\u985E\u5225"},{default:l(a=>[s("span",null,o(a.row.block.name)+" - "+o(a.row.block.code),1)]),_:1}),e(f,{label:"\u529F\u80FD"},{default:l(a=>[s("span",null,o(a.row.name)+" - "+o(a.row.code),1)]),_:1}),e(f,{label:"\u6B0A\u9650"},{default:l(a=>[e(R,{modelValue:a.row.selected,"onUpdate:modelValue":p=>a.row.selected=p},{default:l(()=>[(r(!0),b(v,null,H(a.row.permissions,p=>(r(),B(x,{label:p.code,key:p.code,disabled:u.type==="view"},{default:l(()=>[i(o(p.name),1)]),_:2},1032,["label","disabled"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1},8,["data"])],64)):y("",!0),D.type==="assign"&&c(n).state.show.roleUpdate?(r(),b(v,{key:4},[e(w,null,{default:l(()=>[e(g,null,{default:l(()=>[e(c(S))]),_:1}),i(" \u4EBA\u54E1\u89D2\u8272\u8A2D\u5B9A")]),_:1}),e(F,{border:"",stripe:"",data:A.value.roles,class:"mb-4"},{default:l(()=>[e(f,{label:"\u6B0A\u9650"},{default:l(a=>[e(x,{modelValue:a.row.isSelect,"onUpdate:modelValue":p=>a.row.isSelect=p,label:"\u958B\u555F"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),e(f,{label:"\u89D2\u8272\u4EE3\u865F"},{default:l(a=>[s("span",null,o(a.row.code),1)]),_:1}),e(f,{label:"\u89D2\u8272Name"},{default:l(a=>[s("span",null,o(a.row.name),1)]),_:1})]),_:1},8,["data"])],64)):y("",!0),s("div",O,[e(V,{onClick:k[0]||(k[0]=a=>U("toggleModal",!1))},{default:l(()=>[i("Close")]),_:1}),u.type!=="view"?(r(),B(V,{key:0,type:"primary",onClick:k[1]||(k[1]=a=>M())},{default:l(()=>[i("Save")]),_:1})):y("",!0)])]),_:1},8,["model"])),[[j,c(n).state.progressing]])}}});const X=J(P,[["__scopeId","data-v-de99c23d"]]);export{X as A};
