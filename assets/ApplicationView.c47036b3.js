import{d as Z,i as ee,A as te,b as ae,r as k,e as O,o as le,f as m,K as ue,L as U,k as u,p,l as c,w as e,j as t,h as d,v as i,s as v,g as z,x as R,F as P,m as E,I as me,Y as T,a as ce,O as fe,P as H,_ as J,Q as _e,$ as ge,n as he,S as ve,T as be,U as ye,a0 as De,a1 as W,a2 as X}from"./index.b0b44b5a.js";import{f as j,b as Fe,h as Ee,c as Ce,d as we,n as ke,e as Ae}from"./mixin.fa525c43.js";const Be=["href"],Se=["href"],xe={class:"text-right"},Ve=Z({__name:"ApplicationForm",props:{type:{type:String,default:"view"},id:{type:Number,default:0},path:{type:String,default:""},status:{type:Array,default(){return[]}}},emits:["toggleModal"],setup(Y,{emit:D}){const A=Y,o=ee(te),f=ae(),B=k(),l=k({id:0,company:{name:""},seller:{name:""},name:"",contractTitle:"",contactTime:"",bDay:"",gender:"",contractArea:"",phone:"",email:"",status:0,createdAt:!1,remark:"",fromCompany:"",insType:"",product:"",assortments:"",hasAnnuityEvaluation:!1}),N=O(()=>l.value.product.length>0?l.value.product.split(","):[]);le(async()=>{if(A.id>0){const b=await f.dispatch("getModalData",{http:o,path:A.path,id:A.id});b&&(l.value=b.data)}});const x=()=>{f.commit("updateProgressing",!0),o.get(`${A.path}/AnnuityEvaluationPDF/${A.id}`).then(b=>{f.commit("updateProgressing",!1);const C=Fe(b.data),r=new Blob([C],{type:"application/pdf"}),V="\u9000\u4F11\u91D1\u8A66\u7B97"+Ee(new Date).format("YYYYMMDDhhmmss")+".pdf";Ce(r,V)}).catch(b=>{f.commit("updateProgressing",!1),T.error(b.toString())})};return(b,C)=>{const r=m("el-form-item"),V=m("el-tag"),S=m("el-button"),h=m("el-form"),L=ue("loading");return U((p(),c(h,{ref_key:"formRef",ref:B,model:l.value,"label-width":"100px"},{default:e(()=>[t(r,{label:"\u7DE8\u865F",prop:"id"},{default:e(()=>[d("label",null,i(Y.id),1)]),_:1}),t(r,{label:"\u516C\u53F8",prop:"company.name"},{default:e(()=>[d("label",null,i(l.value.company.name),1)]),_:1}),t(r,{label:"\u696D\u52D9\u54E1",prop:"seller.name"},{default:e(()=>{var F;return[d("label",null,i((F=l.value.seller)==null?void 0:F.name),1)]}),_:1}),t(r,{label:"\u806F\u7D61\u4EBAName",prop:"name"},{default:e(()=>[d("label",null,i(l.value.name),1)]),_:1}),t(r,{label:"\u806F\u7D61\u4EBA\u7A31\u8B02",prop:"contractTitle"},{default:e(()=>[d("label",null,i(l.value.contractTitle==="M"?"\u5148\u751F":"\u5C0F\u59D0"),1)]),_:1}),t(r,{label:"\u806F\u7D61\u4EBA\u5730\u5340",prop:"contractArea"},{default:e(()=>[d("label",null,i(l.value.contractArea),1)]),_:1}),t(r,{label:"\u806F\u7D61\u4EBAPhone",prop:"phone"},{default:e(()=>[d("label",null,i(l.value.phone),1)]),_:1}),t(r,{label:"\u806F\u7D61\u4EBAEmail",prop:"email"},{default:e(()=>[d("label",null,i(l.value.email),1)]),_:1}),t(r,{label:"\u53EF\u806F\u7D61\u6642\u9593",prop:"contactTime"},{default:e(()=>[d("label",null,i(l.value.contactTime),1)]),_:1}),t(r,{label:"\u88AB\u4FDD\u4EBA\u6027\u5225",prop:"gender"},{default:e(()=>[d("label",null,i(l.value.gender==="0"?"\u7537":"\u5973"),1)]),_:1}),t(r,{label:"\u88AB\u4FDD\u4EBA\u751F\u65E5",prop:"bDay"},{default:e(()=>[d("label",null,i(u(j)(l.value.bDay)),1)]),_:1}),t(r,{label:"\u5EFA\u7ACB\u6642\u9593",prop:"createdAt"},{default:e(()=>[d("label",null,i(u(j)(l.value.createdAt)),1)]),_:1}),t(r,{label:"\u72C0\u614B",prop:"status"},{default:e(()=>[t(V,null,{default:e(()=>[v(i(Y.status.filter((F,s)=>l.value.status===s)[0]),1)]),_:1})]),_:1}),t(r,{label:"\u806F\u7D61\u72C0\u6CC1",prop:"remark"},{default:e(()=>[d("label",null,i(l.value.remark),1)]),_:1}),t(r,{label:"\u9032\u4EF6\u516C\u53F8",prop:"fromCompany"},{default:e(()=>[d("label",null,i(l.value.fromCompany),1)]),_:1}),t(r,{label:"\u9700\u6C42",prop:"insType"},{default:e(()=>[d("label",null,i(l.value.insType),1)]),_:1}),l.value.product.length>0?(p(),c(r,{key:0,label:"\u6709\u8208\u8DA3\u5546\u54C1",prop:"productList"},{default:e(()=>[(p(!0),z(P,null,R(N.value,F=>(p(),z("div",{key:`product-${F}`},[d("a",{href:"https://finfo.tw/products/"+F,target:"_blank"},i(F),9,Be)]))),128))]),_:1})):E("",!0),l.value.assortments.length>0?(p(),c(r,{key:1,label:"\u4FDD\u96AA\u7D44\u5408",prop:"assortments"},{default:e(()=>[d("a",{href:"https://finfo.tw/assortments/"+l.value.assortments,target:"_blank"},"https://finfo.tw/assortments/"+i(l.value.assortments),9,Se)]),_:1})):E("",!0),l.value.hasAnnuityEvaluation?(p(),c(r,{key:2,label:"\u9000\u4F11\u91D1\u8A66\u7B97",prop:"hasAnnuityEvaluation"},{default:e(()=>[t(S,{color:"#3D9A9F",icon:u(me),onClick:x},{default:e(()=>[v("PDF \u4E0B\u8F09")]),_:1},8,["icon"])]),_:1})):E("",!0),d("div",xe,[t(S,{onClick:C[0]||(C[0]=F=>D("toggleModal",!1))},{default:e(()=>[v("Close")]),_:1}),A.type!=="view"?(p(),c(S,{key:0,type:"primary",onClick:C[1]||(C[1]=F=>u(f).dispatch("saveData",{http:u(o),path:Y.path,form:l.value,ref:B.value}))},{default:e(()=>[v("Save")]),_:1})):E("",!0)])]),_:1},8,["model"])),[[L,u(f).state.progressing]])}}}),Me=d("div",{class:"card-header"},"Search Filter",-1),Te={class:"grid sm:gap-x-8 sm:grid-cols-2"},Ye=d("div",{class:"card-header flex justify-between items-center"},[d("span",null,"Result")],-1),$e={class:"text-right"},Pe=Z({__name:"ApplicationView",setup(Y){const D=ee(te),A=ce(),o=ae(),f=k(A.path),B=k(!1);fe(()=>{we()});const l=H({company:{id:null},name:"",phone:"",dateStart:null,dateEnd:null}),N=O(()=>({dateStart:[{validator:(s,n,g)=>ke(s,n,g,l.dateEnd),trigger:"blur"}],dateEnd:[{validator:(s,n,g)=>Ae(s,n,g,l.dateStart),trigger:"blur"}]}));le(async()=>{await o.dispatch("getCompany",{http:D}),o.state.company.length&&(l.company.id=Number(o.state.user.companyId))});const x=O(()=>{const s={companyId:l.company.id,page:o.state.page,pageSize:o.state.pageSize};return l.name.length>0&&(s.name=l.name),l.phone.length>0&&(s.phone=l.phone),l.dateStart!==null&&(s.dateStart=l.dateStart),l.dateEnd!==null&&(s.dateEnd=l.dateEnd),s}),b=k(!1),C=k(null),r=async s=>{if(!o.state.show.assign)return;b.value=!0,C.value=s.id;const n=k(s.seller.id);let g=[];const $={companyId:s.company.id,isCustomerApplication:!0};await D.get("/personnel/info/option",{params:$}).then(_=>{g=_.data,b.value=!1}).catch(_=>{b.value=!1,T.error(_.toString())}),await De({title:"\u6307\u6D3E\u696D\u52D9\u54E1",message:()=>W(J,{modelValue:n.value,"onUpdate:modelValue":_=>{n.value=_},filterable:!0},{default:()=>g.map(_=>W(X,{label:`${_.name} - ${_.dept.name}`,value:_.id,key:_.code}))})}).then(async()=>{const _={id:s.id,company:s.company,seller:{id:n.value}};await D.put(f.value+"/assign/"+s.id,_).then(async()=>{T.success("\u6307\u6D3E\u4EBA\u54E1\u6210\u529F"),await o.dispatch("getData",{http:D,path:f.value,data:x.value})}).catch(w=>{T.error(w.toString())})}).catch(()=>{})},V=k(["\u5F85\u8655\u7406","\u5DF2\u806F\u7D61","\u806F\u7D61\u4E2D","\u5DF2\u63D0\u4F9B\u8CC7\u6599","\u7B49\u5F85\u56DE\u8986","\u5DF2\u53D7\u7406","\u5DF2\u62D2\u7D55","\u6301\u7E8C\u8FFD\u8E64"]),S=k(!1),h=H({id:null,company:{id:null},status:0,remark:""}),L=s=>{B.value=!0,h.id=s.id,h.company.id=s.company.id,h.status=s.status,h.remark=s.remark},F=()=>{S.value=!0,D.put(`${f.value}/${h.id}`,h).then(()=>{S.value=!1,B.value=!1,T.success("\u8CC7\u6599\u5DF2\u5132\u5B58\u6210\u529F"),o.dispatch("getData",{http:D,path:f.value,data:x.value})}).catch(s=>{S.value=!1,T.error(s.toString())})};return(s,n)=>{const g=m("el-form-item"),$=m("el-input"),_=m("el-date-picker"),w=m("el-button"),K=m("el-form"),q=m("el-card"),y=m("el-table-column"),Q=m("el-tooltip"),oe=m("el-button-group"),ne=m("el-table"),se=m("el-pagination"),re=m("el-space"),G=m("el-dialog"),de=m("el-radio"),ie=m("el-radio-group"),I=ue("loading");return p(),z(P,null,[t(re,{size:20,fill:!0,class:"w-full px-4"},{default:e(()=>[U((p(),c(q,{class:"box-card"},{header:e(()=>[Me]),default:e(()=>[t(K,{rules:N.value,model:l,"label-position":"left"},{default:e(()=>[d("div",Te,[u(o).state.user.superUser?(p(),c(g,{key:0,label:"\u516C\u53F8",prop:"company.id"},{default:e(()=>[t(u(J),{modelValue:l.company.id,"onUpdate:modelValue":n[0]||(n[0]=a=>l.company.id=a),placeholder:"Please Choose",filterable:""},{default:e(()=>[(p(!0),z(P,null,R(u(o).state.company,a=>(p(),c(u(X),{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):E("",!0),t(g,{label:"\u806F\u7D61\u4EBA",prop:"name"},{default:e(()=>[t($,{modelValue:l.name,"onUpdate:modelValue":n[1]||(n[1]=a=>l.name=a),placeholder:"Enter Name",clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"Phone",prop:"phone"},{default:e(()=>[t($,{modelValue:l.phone,"onUpdate:modelValue":n[2]||(n[2]=a=>l.phone=a),placeholder:"Enter Phone",clearable:""},null,8,["modelValue"])]),_:1}),t(g,{label:"\u63D0\u51FA\u958B\u59CB\u65E5",prop:"dateStart"},{default:e(()=>[t(_,{modelValue:l.dateStart,"onUpdate:modelValue":n[3]||(n[3]=a=>l.dateStart=a),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u958B\u59CB\u65E5"},null,8,["modelValue"])]),_:1}),t(g,{label:"\u63D0\u51FA\u7D50\u675F\u65E5",prop:"dateEnd"},{default:e(()=>[t(_,{modelValue:l.dateEnd,"onUpdate:modelValue":n[4]||(n[4]=a=>l.dateEnd=a),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u7D50\u675F\u65E5"},null,8,["modelValue"])]),_:1})]),u(o).state.show.read?(p(),c(w,{key:0,icon:u(_e),type:"primary",onClick:n[5]||(n[5]=a=>u(o).dispatch("getData",{http:u(D),path:f.value,data:x.value})),class:"!flex w-full sm:w-56 mx-auto"},{default:e(()=>[v("Search")]),_:1},8,["icon"])):E("",!0)]),_:1},8,["rules","model"])]),_:1})),[[I,u(o).state.progressing]]),U((p(),c(q,{class:"box-card"},{header:e(()=>[Ye]),default:e(()=>[t(ne,{data:u(o).state.table,flexible:!0,border:""},{default:e(()=>[t(y,{prop:"id",label:"\u7DE8\u865F",width:"65"}),t(y,{prop:"seller.name",label:u(o).state.show.assign?"\u6307\u6D3E\u696D\u52D9\u54E1":"\u696D\u52D9\u54E1",width:"110"},{default:e(a=>[t(w,{loading:b.value&&C.value===a.row.id,onClick:M=>r(a.row),icon:u(o).state.show.assign&&!a.row.seller.name?u(ge):null,class:he(["w-full",{"hover:!text-blue-500":u(o).state.show.assign,"text-center":u(o).state.show.assign&&!a.row.seller.name}]),title:u(o).state.show.assign?"\u9EDE\u6211\u6307\u6D3E":"",link:""},{default:e(()=>[v(i(a.row.seller.name),1)]),_:2},1032,["loading","onClick","icon","class","title"])]),_:1},8,["label"]),t(y,{prop:"name",label:"\u806F\u7D61\u4EBA",width:"110"}),t(y,{prop:"contractTime",label:"\u53EF\u806F\u7D61\u6642\u9593",width:"100"},{default:e(a=>[v(i(a.row.contactTime==="0"?"":a.row.contactTime),1)]),_:1}),t(y,{prop:"contractArea",label:"\u5730\u5340",width:"80"}),t(y,{prop:"phone",label:"Phone",width:"110"}),t(y,{prop:"insType",label:"\u9700\u6C42"}),t(y,{prop:"remark",label:"\u806F\u7D61\u72C0\u6CC1"}),t(y,{prop:"status",label:"\u72C0\u614B",width:"95"},{default:e(a=>[v(i(V.value.filter((M,pe)=>a.row.status===pe)[0]),1)]),_:1}),t(y,{prop:"fromCompany",label:"\u9032\u4EF6\u516C\u53F8"}),t(y,{prop:"createdAt",label:"\u63D0\u51FA\u6642\u9593",width:"130"},{default:e(a=>[v(i(u(j)(a.row.createdAt)),1)]),_:1}),t(y,{label:"Operate",fixed:"right",width:"110",align:"center"},{default:e(a=>[t(oe,null,{default:e(()=>[u(o).state.show.detail?E("",!0):(p(),c(w,{key:0,icon:u(ve),round:"",disabled:""},{default:e(()=>[v("\u7121\u6B0A\u9650")]),_:1},8,["icon"])),u(o).state.show.detail?(p(),c(Q,{key:1,class:"box-item",effect:"dark",content:"\u700F\u89BD",placement:"top","hide-after":0},{default:e(()=>[t(w,{onClick:M=>u(o).dispatch("action",{type:"view",id:a.row.id}),icon:u(be)},null,8,["onClick","icon"])]),_:2},1024)):E("",!0),u(o).state.show.update?(p(),c(Q,{key:2,class:"box-item",effect:"dark",content:"\u8B8A\u66F4\u72C0\u614B",placement:"top","hide-after":0},{default:e(()=>[t(w,{onClick:M=>L(a.row),icon:u(ye)},null,8,["onClick","icon"])]),_:2},1024)):E("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),u(o).state.table.length>0?(p(),c(se,{key:0,onSizeChange:n[6]||(n[6]=a=>u(o).dispatch("handleSizeChange",{http:u(D),path:f.value,data:x.value,val:a})),onCurrentChange:n[7]||(n[7]=a=>u(o).dispatch("handleCurrentChange",{http:u(D),path:f.value,data:x.value,val:a})),"current-page":u(o).state.page,"onUpdate:currentPage":n[8]||(n[8]=a=>u(o).state.page=a),"page-size":u(o).state.pageSize,"onUpdate:pageSize":n[9]||(n[9]=a=>u(o).state.pageSize=a),"page-sizes":[10,25,50,100],total:u(o).state.total,layout:"total, sizes, prev, pager, next",class:"flex flex-wrap justify-center mt-4"},null,8,["current-page","page-size","total"])):E("",!0)]),_:1})),[[I,u(o).state.progressing]])]),_:1}),t(G,{modelValue:u(o).state.modalOpen,"onUpdate:modelValue":n[11]||(n[11]=a=>u(o).state.modalOpen=a),title:u(o).getters.actionTitle,"append-to-body":!0,"close-on-click-modal":!1,width:"95%",style:{"max-width":"600px"}},{default:e(()=>[(p(),c(Ve,{key:u(o).state.actionType+u(o).state.actionId,onToggleModal:n[10]||(n[10]=a=>u(o).commit("updateModalOpen",a)),status:V.value,type:u(o).state.actionType,id:u(o).state.actionId,path:f.value},null,8,["status","type","id","path"]))]),_:1},8,["modelValue","title"]),t(G,{modelValue:B.value,"onUpdate:modelValue":n[16]||(n[16]=a=>B.value=a),title:"\u8B8A\u66F4\u6848\u4EF6\u72C0\u614B","append-to-body":!0,"close-on-click-modal":!1,width:"95%",style:{"max-width":"460px"}},{default:e(()=>[U((p(),c(K,{model:h},{default:e(()=>[t(g,null,{default:e(()=>[t(ie,{modelValue:h.status,"onUpdate:modelValue":n[12]||(n[12]=a=>h.status=a)},{default:e(()=>[(p(!0),z(P,null,R(V.value,(a,M)=>(p(),c(de,{label:M,key:"changeStatus"+M},{default:e(()=>[v(i(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{prop:"remark"},{default:e(()=>[t($,{modelValue:h.remark,"onUpdate:modelValue":n[13]||(n[13]=a=>h.remark=a),maxlength:"255",type:"textarea",autosize:{minRows:4,maxRows:4},placeholder:"\u806F\u7D61\u72C0\u6CC1",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])),[[I,S.value]]),d("div",$e,[t(w,{onClick:n[14]||(n[14]=a=>B.value=!1)},{default:e(()=>[v("Close")]),_:1}),t(w,{type:"primary",onClick:n[15]||(n[15]=a=>F())},{default:e(()=>[v("Save")]),_:1})])]),_:1},8,["modelValue"])],64)}}});export{Pe as default};
