import{d as B,r as d,W as T,f as v,p as y,g as b,h as M,j as u,w as P,M as L,a3 as N,F as k,x as R,k as S,a4 as A,s as F,v as I,a5 as D,Y as p,i as U,b as z,u as K,K as j,L as $,l as V,N as q,A as O,a6 as W,a0 as Y}from"./index.b0b44b5a.js";const Z="/crm/assets/logo.f3febc55.svg",_=["1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","j","k","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","N","O","P","Q","R","S","T","U","V","X","Y","Z"],G=["#fffff0","#f0ffff","#f0fff0","#fff0f0"],H=["#FF0033","#006699","#993366","#FF9900","#66CC66","#FF33CC"],J={class:"flex"},Q={class:"mt-4 text-right"},X=B({__name:"VerifyCode",props:{type:{type:String,default:"1"},figure:{type:Number,default:100},arith:{type:Number,default:0},width:{type:String,default:"150px"},height:{type:String,default:"100%"},fontSize:{type:String,default:"20px"},codeLength:{type:Number,default:6},checkText:{type:String,default:"\u9A57\u8B49"}},emits:["success"],setup(h,{emit:w}){const s=h,C=d(!1),r=d(""),t=d("#fff"),g=d("#fff"),i=d(""),n=d([]),o=()=>{if(C.value===!1){if(t.value=G[Math.floor(Math.random()*3)],g.value=H[Math.floor(Math.random()*5)],r.value="",n.value=[],i.value="",s.type==="1")for(let e=0;e<s.codeLength;e++){const a=Math.floor(Math.random()*52);let l=a%2===0?"font-style:italic;":"font-weight:bolder";l+=Math.floor(Math.random()*2)===1?"font-weight:bolder":"",i.value+=_[a],n.value.push({style:l,char:_[a]+""})}else if(s.type==="2"){let e=Math.floor(Math.random()*s.figure),a=Math.floor(Math.random()*s.figure),l="";if(s.arith===0)switch(Math.floor(Math.random()*3)){case 1:i.value=_[e+a]+"",l=e+" + "+a+" = ?";break;case 2:if(e<a){const f=e;e=a,a=f}i.value=_[e-a]+"",l=e+" - "+a+" = ?";break;default:i.value=_[e-a]+"",l=e+" \xD7 "+a+" = ?";break}l.split("").forEach(x=>{n.value.push({char:x,style:""})})}}},c=()=>{let e,a;s.type==="1"?(e=r.value.toUpperCase(),a=i.value.toUpperCase()):(e=r.value,a=i.value),e===a?(C.value=!0,w("success",this)):r.value===""?(p.error("Not Entered Verify Code"),o()):(p.error("Wrong Verify Code"),o())};return T(()=>s.type,()=>{o()},{immediate:!0}),(e,a)=>{const l=v("el-input"),m=v("el-form-item"),x=v("el-button");return y(),b(k,null,[M("section",J,[u(m,{class:"flex-1 mr-4"},{default:P(()=>[u(l,{modelValue:r.value,"onUpdate:modelValue":a[0]||(a[0]=f=>r.value=f),onKeydown:L(c,["enter"]),placeholder:"verify code",clearable:""},null,8,["modelValue","onKeydown"])]),_:1}),M("div",{class:"flex items-center justify-center rounded",style:N({width:h.width,height:h.height,"font-size":h.fontSize,"background-color":t.value,color:g.value})},[(y(!0),b(k,null,R(n.value,(f,E)=>(y(),b("span",{style:N(f.style),key:E},I(f.char||f),5))),128))],4),u(x,{onClick:o,class:"cursor-pointer",icon:S(A)},null,8,["icon"])]),M("div",Q,[u(x,{onClick:c,icon:S(D),class:"self-items-end"},{default:P(()=>[F(I(h.checkText),1)]),_:1},8,["icon"])])],64)}}}),ee={class:"h-full flex flex-col justify-center items-center"},ae=M("p",{class:"flex items-center text-3xl mt-4 mb-10"},[M("img",{src:Z,width:"48",class:"mr-3"}),F(" PARTNER SYSTEM ")],-1),oe=B({__name:"LoginPage",setup(h){const w=U(O),s=z(),C=K(),r=d(!1),t=d({username:"",password:""}),g=d(0),i=()=>{if(t.value.username===""||t.value.password===""){p.error("Please enter account or password");return}if(r.value=!0,s.state.testModel){const n={roles:"admin",jti:"884e83b5-95ba-4c91-9482-046a66e9e502",iss:"webApi",sub:"admin",exp:1678699511,nbf:1678692311,iat:1678692311,id:"1",name:"Administrator",permission:{Block:[{Name:"Company",Code:"company",Index:"1",Patten:[{Name:"Company Maintain",Code:"info",Index:"1-1",Permission:["create","read","delete","update","detail"]}]},{Name:"Department",Code:"dept",Index:"2",Patten:[{Name:"Type Maintain",Code:"type",Index:"2-1",Permission:["create","read","delete","update","detail"]},{Name:"Department Maintain",Code:"info",Index:"2-2",Permission:["detail","create","read","delete","update"]}]},{Name:"Member",Code:"personnel",Index:"3",Patten:[{Name:"Member Maintain",Code:"info",Index:"3-1",Permission:["detail","create","read","delete","update"]}]},{Name:"Role Manage",Code:"role",Index:"4",Patten:[{Name:"Role Maintain",Code:"info",Index:"4-1",Permission:["create","read","delete","update","detail"]}]},{Name:"Permission Manage",Code:"permission",Index:"5",Patten:[{Name:"Member Permission",Code:"assign",Index:"5-1",Permission:["read","update","roleDetail","detail","roleUpdate"]},{Name:"Role Permission",Code:"assignRole",Index:"5-2",Permission:["update","detail","read"]}]},{Name:"Customer Manage",Code:"customer",Index:"6",Patten:[{Name:"Insurance Needs",Code:"application",Index:"6-1",Permission:["detail","read","assign","update"]}]},{Name:"System Manage",Code:"system",Index:"7",Patten:[{Name:"Operation Record",Code:"log",Index:"7-1",Permission:["read","detail"]}]}]},username:"admin",companyId:"1",companyCode:"TestCompany",companyName:"TestCompany",superUser:!0};t.value.username==="admin"&&t.value.password==="1234"&&(s.commit("updateUser",n),C.push("/")),t.value.username!=="admin"&&p.error("wrong account"),t.value.password!=="1234"&&p.error("wrong password"),r.value=!1;return}w.post("/auth",{username:t.value.username,password:t.value.password}).then(async n=>{r.value=!1;const o=n.data.auth_token;w.defaults.headers.common.Authorization=`Bearer ${o}`,await s.dispatch("login",{authToken:o,user:W(o)}),n.data.needChangePWD?await Y.prompt("The password has been used for more than six months, please change it.","Reset Password",{type:"warning",showClose:!1,closeOnClickModal:!1,showCancelButton:!1,inputPlaceholder:"Enter new password",inputPattern:/^[A-Za-z0-9_]{8,20}$/,inputErrorMessage:"8~20, only English, number, underscore",confirmButtonText:"It is correct, confirm !",beforeClose:async(c,e,a)=>{c==="confirm"&&(e.confirmButtonLoading=!0,await s.dispatch("changePassword",{http:w,data:{newPassword:e.inputValue,oldPassword:t.value.password}})?(a(),t.value.password="",g.value++,p({type:"warning",message:"Login again\u{1F91F}",duration:5e3})):e.confirmButtonLoading=!1)}}):C.push("/")}).catch(n=>{r.value=!1,p.error(n.response.data),n.response.status===400&&(g.value+=1)})};return(n,o)=>{const c=v("el-input"),e=v("el-form-item"),a=v("el-form"),l=j("loading");return y(),b("main",ee,[ae,$((y(),V(a,{model:t.value,size:"large",class:"login-form",ref:"loginFormRef",onSubmit:o[3]||(o[3]=q(()=>{},["prevent"]))},{default:P(()=>[u(e,{prop:"username",rules:[{required:!0,message:"Please enter account",trigger:"blur"}]},{default:P(()=>[u(c,{type:"text",modelValue:t.value.username,"onUpdate:modelValue":o[0]||(o[0]=m=>t.value.username=m),minlength:"8",maxlength:"50",placeholder:"Account : admin",class:"login-input",clearable:""},null,8,["modelValue"])]),_:1}),u(e,{prop:"password",rules:[{required:!0,message:"Please enter password",trigger:"blur"}]},{default:P(()=>[u(c,{type:"password",modelValue:t.value.password,"onUpdate:modelValue":o[1]||(o[1]=m=>t.value.password=m),minlength:"8",maxlength:"50",placeholder:"Password : 1234",class:"login-input",clearable:""},null,8,["modelValue"])]),_:1}),(y(),V(X,{ref:"verify",key:g.value,onSuccess:o[2]||(o[2]=m=>i()),"check-text":"Login ",type:"1",height:"40px"}))]),_:1},8,["model"])),[[l,r.value]])])}}});export{oe as default};
