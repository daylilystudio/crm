import{d as K,i as P,A as W,b as Q,O as X,r as D,e as G,o as H,W as R,Y as q,f as m,K as J,L as N,k as a,p as t,l as r,w as u,g,v as k,x as F,F as B,m as C,j as o,h as U,s as I,a as Z,P as ee,Q as ae,R as te,S as le,T as ue,U as oe,V as ne}from"./index.f9e09ed2.js";import{d as de,f as L,o as re}from"./mixin.fa525c43.js";import{A as S}from"./AddItem.b02d14ac.js";import"./_plugin-vue_export-helper.cdc0426e.js";const se={key:0},ie={key:0},pe={key:0},me={key:0},ce={key:0},fe={key:0},ye={key:0},ve={key:0},_e={key:0},ge={key:0},be={class:"text-right"},he=K({__name:"InfoForm",props:{type:{type:String,default:"view"},id:{type:Number,default:0},path:{type:String,default:""}},emits:["toggleModal"],setup(z,{emit:A}){const i=z,l=P(W),b=Q();X(()=>{de()});const v=D(),e=D({id:0,code:"",name:"",address:"",establishDate:"",writeoffDate:null,remark:"",company:{id:null},type:{id:null},upper:{id:null},principal:{id:null},webItems:[],emailItems:[],phoneItems:[],faxItems:[]}),V=G(()=>({code:[{required:!0,message:"\u8ACB\u8F38\u5165\u4EE3\u78BC",trigger:"blur"},{max:20,message:"\u6700\u5927\u9577\u5EA6\u70BA20",trigger:"blur"},{validator:re,trigger:"blur"}],name:[{required:!0,message:"\u8ACB\u8F38\u5165\u540D\u7A31",trigger:"blur"},{max:50,message:"\u6700\u5927\u9577\u5EA6\u70BA50",trigger:"blur"}],address:[{required:!0,message:"\u8ACB\u8F38\u5165\u5730\u5740",trigger:"blur"},{max:255,message:"\u6700\u5927\u9577\u5EA6\u70BA255",trigger:"blur"}],establishDate:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}],company:{id:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}]},type:{id:[{required:!0,message:"\u8ACB\u9078\u64C7",trigger:"change"}]}})),p=D([]),x=D([]),Y=D([]);return H(async()=>{if(i.id>0){const h=await b.dispatch("getModalData",{http:l,path:i.path,id:i.id});h&&(e.value=h.data)}if(b.state.company.length&&i.type!=="edit"&&(e.value.company.id=b.state.company[0].id),i.type!=="view"){R(()=>e.value.company.id,n=>{i.type==="add"&&(e.value.type.id=null,e.value.principal.id=null);const _={companyId:n};l.get("/dept/type/option",{params:_}).then(f=>{p.value=f.data}).catch(f=>{q.error(f.toString())}),l.get("/personnel/info/option",{params:_}).then(f=>{Y.value=f.data}).catch(f=>{q.error(f.toString())})},{immediate:!0});const h=D(0);R(()=>e.value.type.id,n=>{h.value++;const _={companyId:e.value.company.id,overDeptTypeId:n};n!==null?l.get("/dept/info/option",{params:_}).then(f=>{x.value=f.data,(h.value!==1||i.type!=="edit")&&(e.value.upper.id=null)}).catch(f=>{q.error(f.toString())}):x.value=[]},{immediate:!0})}}),(h,n)=>{const _=m("el-option"),f=m("el-select"),y=m("el-form-item"),w=m("el-input"),E=m("el-date-picker"),M=m("el-button"),$=m("el-form"),T=J("loading");return N((t(),r($,{ref_key:"formRef",ref:v,model:e.value,rules:V.value,"label-width":"100px"},{default:u(()=>[a(b).state.user.superUser?(t(),r(y,{key:0,label:"\u6240\u5C6C\u516C\u53F8",prop:"company.id"},{default:u(()=>[i.type==="view"?(t(),g("label",se,k(e.value.company.name),1)):(t(),r(f,{key:1,modelValue:e.value.company.id,"onUpdate:modelValue":n[0]||(n[0]=d=>e.value.company.id=d),disabled:i.type==="edit",placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(t(!0),g(B,null,F(a(b).state.company,d=>(t(),r(_,{key:d.id,label:d.name,value:d.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]))]),_:1})):C("",!0),o(y,{label:"\u90E8\u9580\u985E\u5225",prop:"type.id"},{default:u(()=>{var d;return[i.type==="view"?(t(),g("label",ie,k((d=e.value.type)==null?void 0:d.name),1)):(t(),r(f,{key:1,modelValue:e.value.type.id,"onUpdate:modelValue":n[1]||(n[1]=c=>e.value.type.id=c),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(t(!0),g(B,null,F(p.value,c=>(t(),r(_,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1}),o(y,{label:"\u4E0A\u4F4D\u90E8\u9580",prop:"dept.id"},{default:u(()=>{var d;return[i.type==="view"?(t(),g("label",pe,k((d=e.value.upper)==null?void 0:d.name),1)):(t(),r(f,{key:1,modelValue:e.value.upper.id,"onUpdate:modelValue":n[2]||(n[2]=c=>e.value.upper.id=c),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(t(!0),g(B,null,F(x.value,c=>(t(),r(_,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1}),o(y,{label:"\u8CA0\u8CAC\u4EBA",prop:"principal.id"},{default:u(()=>{var d;return[i.type==="view"?(t(),g("label",me,k((d=e.value.principal)==null?void 0:d.name),1)):(t(),r(f,{key:1,modelValue:e.value.principal.id,"onUpdate:modelValue":n[3]||(n[3]=c=>e.value.principal.id=c),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(t(!0),g(B,null,F(Y.value,c=>(t(),r(_,{key:c.id,label:c.name,value:c.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))]}),_:1}),o(y,{label:"\u90E8\u9580\u4EE3\u865F",prop:"code"},{default:u(()=>[i.type==="view"?(t(),g("label",ce,k(e.value.code),1)):(t(),r(w,{key:1,modelValue:e.value.code,"onUpdate:modelValue":n[4]||(n[4]=d=>e.value.code=d),maxlength:"20",clearable:""},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u90E8\u9580\u540D\u7A31",prop:"name"},{default:u(()=>[i.type==="view"?(t(),g("label",fe,k(e.value.name),1)):(t(),r(w,{key:1,modelValue:e.value.name,"onUpdate:modelValue":n[5]||(n[5]=d=>e.value.name=d),clearable:""},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u90E8\u9580\u5730\u5740",prop:"address"},{default:u(()=>[i.type==="view"?(t(),g("label",ye,k(e.value.address),1)):(t(),r(w,{key:1,modelValue:e.value.address,"onUpdate:modelValue":n[6]||(n[6]=d=>e.value.address=d),clearable:""},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u6210\u7ACB\u65E5\u671F",prop:"establishDate"},{default:u(()=>[i.type==="view"?(t(),g("label",ve,k(a(L)(e.value.establishDate)),1)):(t(),r(E,{key:1,modelValue:e.value.establishDate,"onUpdate:modelValue":n[7]||(n[7]=d=>e.value.establishDate=d),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u8ACB\u9078\u64C7"},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u8A3B\u92B7\u65E5\u671F",prop:"writeoffDate"},{default:u(()=>[i.type==="view"?(t(),g("label",_e,k(a(L)(e.value.writeoffDate)),1)):(t(),r(E,{key:1,modelValue:e.value.writeoffDate,"onUpdate:modelValue":n[8]||(n[8]=d=>e.value.writeoffDate=d),type:"date",format:"YYYY/MM/DD","value-format":"YYYY-MM-DD",placeholder:"\u8ACB\u9078\u64C7"},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u5099\u8A3B",prop:"remark"},{default:u(()=>[i.type==="view"?(t(),g("label",ge,k(e.value.remark),1)):(t(),r(w,{key:1,modelValue:e.value.remark,"onUpdate:modelValue":n[9]||(n[9]=d=>e.value.remark=d),clearable:""},null,8,["modelValue"]))]),_:1}),o(y,{label:"\u90E8\u9580\u7DB2\u7AD9"},{default:u(()=>[o(S,{arrays:e.value.webItems,"label-title":"\u7DB2\u5740","can-save":i.type!=="view",ref:"web"},null,8,["arrays","can-save"])]),_:1}),o(y,{label:"\u90E8\u9580Email"},{default:u(()=>[o(S,{arrays:e.value.emailItems,"label-title":"Email","can-save":i.type!=="view",keyWord:"email",ref:"email"},null,8,["arrays","can-save"])]),_:1}),o(y,{label:"\u90E8\u9580\u96FB\u8A71"},{default:u(()=>[o(S,{arrays:e.value.phoneItems,"label-title":"\u96FB\u8A71","can-save":i.type!=="view",ref:"phone"},null,8,["arrays","can-save"])]),_:1}),o(y,{label:"\u90E8\u9580\u50B3\u771F"},{default:u(()=>[o(S,{arrays:e.value.faxItems,"label-title":"\u50B3\u771F","can-save":i.type!=="view",ref:"fax"},null,8,["arrays","can-save"])]),_:1}),U("div",be,[o(M,{onClick:n[10]||(n[10]=d=>A("toggleModal",!1))},{default:u(()=>[I("\u95DC\u9589")]),_:1}),i.type!=="view"?(t(),r(M,{key:0,type:"primary",onClick:n[11]||(n[11]=d=>a(b).dispatch("saveData",{http:a(l),path:z.path,form:e.value,ref:v.value}))},{default:u(()=>[I("\u5132\u5B58")]),_:1})):C("",!0)])]),_:1},8,["model","rules"])),[[T,a(b).state.progressing]])}}}),ke=U("div",{class:"card-header"},"\u67E5\u8A62\u689D\u4EF6",-1),Ce={class:"grid sm:gap-x-8 sm:grid-cols-2"},we={class:"card-header flex justify-between items-center"},Ae=U("span",null,"\u67E5\u8A62\u7D50\u679C",-1),xe=K({__name:"InfoView",setup(z){const A=P(W),i=Z(),l=Q(),b=D(i.path),v=ee({code:"",name:"",company:{id:null}});H(async()=>{await l.dispatch("getCompany",{http:A}),l.state.company.length&&(v.company.id=Number(l.state.user.companyId))});const e=G(()=>{const V={page:l.state.page,pageSize:l.state.pageSize};return v.code.length>0&&(V.code=v.code),v.name.length>0&&(V.name=v.name),v.company.id>0&&(V.companyId=v.company.id),V});return(V,p)=>{const x=m("el-option"),Y=m("el-select"),h=m("el-form-item"),n=m("el-input"),_=m("el-button"),f=m("el-form"),y=m("el-card"),w=m("el-table-column"),E=m("el-tooltip"),M=m("el-button-group"),$=m("el-table"),T=m("el-pagination"),d=m("el-space"),c=m("el-dialog"),j=J("loading");return t(),g(B,null,[o(d,{size:20,fill:!0,class:"w-full px-4"},{default:u(()=>[N((t(),r(y,{class:"box-card"},{header:u(()=>[ke]),default:u(()=>[o(f,{"label-position":"left"},{default:u(()=>[U("div",Ce,[a(l).state.user.superUser?(t(),r(h,{key:0,label:"\u6240\u5C6C\u516C\u53F8",prop:"company.id"},{default:u(()=>[o(Y,{modelValue:v.company.id,"onUpdate:modelValue":p[0]||(p[0]=s=>v.company.id=s),placeholder:"\u8ACB\u9078\u64C7",filterable:""},{default:u(()=>[(t(!0),g(B,null,F(a(l).state.company,s=>(t(),r(x,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):C("",!0),o(h,{label:"\u90E8\u9580\u4EE3\u865F",prop:"code"},{default:u(()=>[o(n,{modelValue:v.code,"onUpdate:modelValue":p[1]||(p[1]=s=>v.code=s),placeholder:"\u8F38\u5165\u90E8\u9580\u4EE3\u865F",maxlength:"20",clearable:""},null,8,["modelValue"])]),_:1}),o(h,{label:"\u90E8\u9580\u540D\u7A31",prop:"name"},{default:u(()=>[o(n,{modelValue:v.name,"onUpdate:modelValue":p[2]||(p[2]=s=>v.name=s),placeholder:"\u8F38\u5165\u90E8\u9580\u540D\u7A31",clearable:""},null,8,["modelValue"])]),_:1})]),a(l).state.show.read?(t(),r(_,{key:0,icon:a(ae),type:"primary",onClick:p[3]||(p[3]=s=>a(l).dispatch("getData",{http:a(A),path:b.value,data:e.value})),class:"!flex w-full sm:w-56 mx-auto"},{default:u(()=>[I("\u9EDE\u6211\u67E5\u8A62")]),_:1},8,["icon"])):C("",!0)]),_:1})]),_:1})),[[j,a(l).state.progressing]]),N((t(),r(y,{class:"box-card"},{header:u(()=>[U("div",we,[Ae,a(l).state.show.create?(t(),r(_,{key:0,onClick:p[4]||(p[4]=s=>a(l).dispatch("action",{type:"add",id:0})),icon:a(te),type:"primary",plain:""},{default:u(()=>[I("\u65B0\u589E\u90E8\u9580")]),_:1},8,["icon"])):C("",!0)])]),default:u(()=>[o($,{data:a(l).state.table,flexible:!0,border:""},{default:u(()=>[o(w,{prop:"code",label:"\u90E8\u9580\u4EE3\u78BC"}),o(w,{prop:"name",label:"\u90E8\u9580\u540D\u7A31"}),o(w,{prop:"principal.name",label:"\u8CA0\u8CAC\u4EBA"}),o(w,{label:"\u64CD\u4F5C",fixed:"right",width:"150",align:"center"},{default:u(s=>[o(M,null,{default:u(()=>[a(l).state.show.detail?C("",!0):(t(),r(_,{key:0,icon:a(le),round:"",disabled:""},{default:u(()=>[I("\u7121\u6B0A\u9650")]),_:1},8,["icon"])),a(l).state.show.detail?(t(),r(E,{key:1,class:"box-item",effect:"dark",content:"\u700F\u89BD",placement:"top","hide-after":0},{default:u(()=>[o(_,{onClick:O=>a(l).dispatch("action",{type:"view",id:s.row.id}),icon:a(ue)},null,8,["onClick","icon"])]),_:2},1024)):C("",!0),a(l).state.show.update?(t(),r(E,{key:2,class:"box-item",effect:"dark",content:"\u7DE8\u8F2F",placement:"top","hide-after":0},{default:u(()=>[o(_,{onClick:O=>a(l).dispatch("action",{type:"edit",id:s.row.id}),icon:a(oe)},null,8,["onClick","icon"])]),_:2},1024)):C("",!0),a(l).state.show.delete?(t(),r(E,{key:3,class:"box-item",effect:"dark",content:"\u522A\u9664",placement:"top","hide-after":0},{default:u(()=>[o(_,{onClick:O=>a(l).dispatch("handleDelete",{http:a(A),path:b.value,data:e.value,row:s.row}),icon:a(ne),type:"danger",plain:""},null,8,["onClick","icon"])]),_:2},1024)):C("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"]),a(l).state.table.length>0?(t(),r(T,{key:0,onSizeChange:p[5]||(p[5]=s=>a(l).dispatch("handleSizeChange",{http:a(A),path:b.value,data:e.value,val:s})),onCurrentChange:p[6]||(p[6]=s=>a(l).dispatch("handleCurrentChange",{http:a(A),path:b.value,data:e.value,val:s})),"current-page":a(l).state.page,"onUpdate:currentPage":p[7]||(p[7]=s=>a(l).state.page=s),"page-size":a(l).state.pageSize,"onUpdate:pageSize":p[8]||(p[8]=s=>a(l).state.pageSize=s),"page-sizes":[10,25,50,100],total:a(l).state.total,layout:"total, sizes, prev, pager, next",class:"flex flex-wrap justify-center mt-4"},null,8,["current-page","page-size","total"])):C("",!0)]),_:1})),[[j,a(l).state.progressing]])]),_:1}),o(c,{modelValue:a(l).state.modalOpen,"onUpdate:modelValue":p[10]||(p[10]=s=>a(l).state.modalOpen=s),title:a(l).getters.actionTitle,"append-to-body":!0,"close-on-click-modal":!1,width:"95%",style:{"max-width":"600px"}},{default:u(()=>[(t(),r(he,{key:a(l).state.actionType+a(l).state.actionId,onToggleModal:p[9]||(p[9]=s=>a(l).commit("updateModalOpen",s)),type:a(l).state.actionType,id:a(l).state.actionId,path:b.value},null,8,["type","id","path"]))]),_:1},8,["modelValue","title"])],64)}}});export{xe as default};
